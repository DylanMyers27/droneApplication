<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon"
      type="image/png"
      href="img/FIULogo.png">
    <title>Water Quality Sampling Drone Application</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"/>
    <link href="css/main.css" rel="stylesheet"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
    <script>
      var previous = null;
      var current = null;
      setInterval(function() {
          $.getJSON("data.json", function(json) {
              current = JSON.stringify(json);
              if (previous && current && previous !== current) {
                  console.log('refresh');
                  location.reload();
              }
              previous = current;
          });
      }, 1000);
    </script>
    <script type="text/javascript" >
              $(document).ready(function init() {
               loadJSON(function(response) {
                  actual_JSON = JSON.parse(response);

                  console.table(actual_JSON);
               });
               return actual_JSON;
             });

      $(document).ready(function () {

      var dps = []; // dataPoints
      var chart = new CanvasJS.Chart("chartContainer", {
          title :{
              text: "Nitrate Concentrations"
          },
          axisY: {
              includeZero: false,
              title: "Nitrate Levels",
          },
          axisX:{
              title: "Number of Samples"
          },
          data: [{
              type: "line",
              dataPoints: dps,
          }]
      });


      var xVal = 0;
      var yVal = 5.0;
      var updateInterval = 2500;
      var dataLength = 10; // number of dataPoints visible at any point

      var updateChart = function (count) {

          count = count || 1;

          for (var j = 0; j < count; j++) {
              yVal = Number(actual_JSON[j].Latitude);
              dps.push({
                  x: xVal,
                  y: yVal
              });
              xVal++;
          }

          if (dps.length < dataLength) {
              dps.shift();
          }

          chart.render();
      };

      updateChart(dataLength);
      setInterval(function(){updateChart()}, updateInterval);
    });
    </script>
  </head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-*">
    <a class="navbar-brand" href="#">Water Quality Sampling Drone</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
           aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="#mapContainer">Map</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#tableData">Table Data</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#chartContainer">Nitrate Levels Graph</a>
            </li>
          </ul>
        </div>
  </nav>

  <div class="container" id="gettingStarted">
    <h3>Welcome to the Water Quality Sampling Drone Web Application <br> Here is a couple of tips to get you started</h3>
    <p>
      <ol id = "list">
        <li>Use the nav bar to navigate throughout the application</li>
        <li>Data will show in real-time on the table shown below</li>
        <li>Enter the drone operators name on the table below</li>
        <li>Once the drone is in the water, press the "Start Sequence" button</li>
        <li>If you are not happy with the result of the test, just run the testing sequence again!</li>
      </ol>
    </p>
  </div>
<div id="startBtn" class="container">
  <button type="button" class="btn btn-lg btn-primary" onclick="myAlert()" name="button" style= "display:block; margin-left: auto; margin-right: auto;">Start Testing Sequence</button>

  <script>
  function myAlert() {
      alert("Starting test Sequence");
  }
  </script>
</div>

<div id="mapContainer" class="container">
  <div class="row">
    <div class="col-sm-6">
      <h1 style="color:white;">Geolocation of Drone</h1>
    </div>
    <div class="col-sm-6">
      <button type="button" onclick="initMap()" style="float:right"class="btn btn-dark" name="button">Refresh Maps</button>
    </div>
  </div>
  <div id="map"></div>
</div>

<br>
  <div id="tableData" class="container">
    <div class="row">
      <div class="col-sm-3">
        <h1>Data Table</h1>
      </div>
      <div class="col-sm-4" style="padding-top:7.5px;">
        <input type="text" name="fname" id="fname" placeholder="First Name" style="border-radius:5px; ">
        <button  id="submitNameBtn" class="btn btn-dark" onclick="submitFunction()" >Submit</button>
      </div>
      <div class="col-sm-5" style="padding-top:7.5px;">
        <!-- <input type="text" name="csvName" id="csvName" placeholder="droneData.csv" style="border-radius:5px;"> -->
        <button type="button" onclick="exportTableToCSV()" style="float:right" class="btn btn-dark">Export to CSV</button>
      </div>
    </div>



    <table id="myTable" class="table">
        <tr>
          <th >Drone Operator</th>
          <th>DateTime</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Nitrate Level (mg/L)</th>
        </tr>
    </table>
  </div>

<div id="chartContainer" style="height: 600px; width: 75%; margin-left: auto; margin-right: auto;border-radius: 20px;"></div>

    <a href="#" class="back-to-top"> <img src="img/upbtn.png" class ="up" alt="up"> </a>

    <footer style = "background-color:#081E3f;">
      <a href="https://www.instagram.com/waterqualitysamplingdrone/?hl=en" target="_blank"><img src="img/instaLogo.png" class="instagram"></a>
      <a href="https://www.linkedin.com/in/dylan-myers/" target="_blank" ><img src="img/DylanHeadshot.png" class="headshot" style="height:30px; border-radius:5px;"></a>
    </footer>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB86Iq8lcUqgtMSdGpX42A9F1c3rDBmTMw&callback=initMap&v=3.31"></script>

    <script src="js/main.js"></script>
</body>

</html>
